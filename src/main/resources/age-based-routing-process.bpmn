<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" 
                  xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" 
                  xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" 
                  xmlns:di="http://www.omg.org/spec/DD/20100524/DI" 
                  xmlns:camunda="http://camunda.org/schema/1.0/bpmn" 
                  id="Definitions_age_routing" 
                  targetNamespace="http://bpmn.io/schema/bpmn" 
                  exporter="Camunda Modeler" 
                  exporterVersion="5.0.0">
  
  <bpmn:process id="age-based-routing-process" name="Age-Based Person Routing Process" isExecutable="true" camunda:historyTimeToLive="P30D">
    
    <!-- Start Event -->
    <bpmn:startEvent id="age_start_event" name="Start Age-Based Routing">
      <bpmn:outgoing>age_flow_start_to_routing</bpmn:outgoing>
    </bpmn:startEvent>
    
    <!-- Age-Based Routing Task -->
    <bpmn:serviceTask id="age_routing_task" name="Determine Target Database by Age" camunda:delegateExpression="${ageBasedRoutingDelegate}">
      <bpmn:incoming>age_flow_start_to_routing</bpmn:incoming>
      <bpmn:outgoing>age_flow_routing_to_gateway</bpmn:outgoing>
    </bpmn:serviceTask>
    
    <!-- Gateway for Person Found -->
    <bpmn:exclusiveGateway id="age_person_found_gateway" name="Person Found?">
      <bpmn:incoming>age_flow_routing_to_gateway</bpmn:incoming>
      <bpmn:outgoing>age_flow_person_found</bpmn:outgoing>
      <bpmn:outgoing>age_flow_person_not_found</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    
    <!-- Gateway for Age Check -->
    <bpmn:exclusiveGateway id="age_check_gateway" name="Is Minor?">
      <bpmn:incoming>age_flow_person_found</bpmn:incoming>
      <bpmn:outgoing>age_flow_is_minor</bpmn:outgoing>
      <bpmn:outgoing>age_flow_is_adult</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    
    <!-- Process Minor -->
    <bpmn:serviceTask id="age_process_minor_task" name="Process Minor (Minors DB)" camunda:delegateExpression="${personProcessingDelegate}">
      <bpmn:incoming>age_flow_is_minor</bpmn:incoming>
      <bpmn:outgoing>age_flow_minor_to_success</bpmn:outgoing>
    </bpmn:serviceTask>
    
    <!-- Process Adult -->
    <bpmn:serviceTask id="age_process_adult_task" name="Process Adult (Adults DB)" camunda:delegateExpression="${personProcessingDelegate}">
      <bpmn:incoming>age_flow_is_adult</bpmn:incoming>
      <bpmn:outgoing>age_flow_adult_to_success</bpmn:outgoing>
    </bpmn:serviceTask>
    
    <!-- Success End Event -->
    <bpmn:endEvent id="age_success_end_event" name="Successfully Processed">
      <bpmn:incoming>age_flow_minor_to_success</bpmn:incoming>
      <bpmn:incoming>age_flow_adult_to_success</bpmn:incoming>
    </bpmn:endEvent>
    
    <!-- Not Found End Event -->
    <bpmn:endEvent id="age_not_found_end_event" name="Person Not Found">
      <bpmn:incoming>age_flow_person_not_found</bpmn:incoming>
    </bpmn:endEvent>
    
    <!-- Sequence Flows -->
    <bpmn:sequenceFlow id="age_flow_start_to_routing" sourceRef="age_start_event" targetRef="age_routing_task" />
    <bpmn:sequenceFlow id="age_flow_routing_to_gateway" sourceRef="age_routing_task" targetRef="age_person_found_gateway" />
    
    <bpmn:sequenceFlow id="age_flow_person_found" name="Yes" sourceRef="age_person_found_gateway" targetRef="age_check_gateway">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">${personFound == true}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    
    <bpmn:sequenceFlow id="age_flow_person_not_found" name="No" sourceRef="age_person_found_gateway" targetRef="age_not_found_end_event">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">${personFound == false}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    
    <bpmn:sequenceFlow id="age_flow_is_minor" name="Yes (under 18)" sourceRef="age_check_gateway" targetRef="age_process_minor_task">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">${isMinor == true}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    
    <bpmn:sequenceFlow id="age_flow_is_adult" name="No (18 and over)" sourceRef="age_check_gateway" targetRef="age_process_adult_task">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">${isMinor == false}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    
    <bpmn:sequenceFlow id="age_flow_minor_to_success" sourceRef="age_process_minor_task" targetRef="age_success_end_event" />
    <bpmn:sequenceFlow id="age_flow_adult_to_success" sourceRef="age_process_adult_task" targetRef="age_success_end_event" />
    
  </bpmn:process>
  
  <!-- Diagram Information -->
  <bpmndi:BPMNDiagram id="BPMNDiagram_age_routing">
    <bpmndi:BPMNPlane id="BPMNPlane_age_routing" bpmnElement="age-based-routing-process">
      
      <!-- Start Event -->
      <bpmndi:BPMNShape id="age_start_shape" bpmnElement="age_start_event">
        <dc:Bounds x="180" y="120" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="156" y="163" width="85" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      
      <!-- Routing Task -->
      <bpmndi:BPMNShape id="age_routing_shape" bpmnElement="age_routing_task">
        <dc:Bounds x="270" y="98" width="100" height="80" />
      </bpmndi:BPMNShape>
      
      <!-- Person Found Gateway -->
      <bpmndi:BPMNShape id="age_person_gateway_shape" bpmnElement="age_person_found_gateway" isMarkerVisible="true">
        <dc:Bounds x="425" y="113" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="417" y="86" width="67" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      
      <!-- Age Check Gateway -->
      <bpmndi:BPMNShape id="age_check_gateway_shape" bpmnElement="age_check_gateway" isMarkerVisible="true">
        <dc:Bounds x="525" y="113" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="529" y="86" width="43" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      
      <!-- Process Minor Task -->
      <bpmndi:BPMNShape id="age_minor_task_shape" bpmnElement="age_process_minor_task">
        <dc:Bounds x="630" y="50" width="100" height="80" />
      </bpmndi:BPMNShape>
      
      <!-- Process Adult Task -->
      <bpmndi:BPMNShape id="age_adult_task_shape" bpmnElement="age_process_adult_task">
        <dc:Bounds x="630" y="180" width="100" height="80" />
      </bpmndi:BPMNShape>
      
      <!-- Success End Event -->
      <bpmndi:BPMNShape id="age_success_end_shape" bpmnElement="age_success_end_event">
        <dc:Bounds x="780" y="120" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="767" y="163" width="62" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      
      <!-- Not Found End Event -->
      <bpmndi:BPMNShape id="age_not_found_end_shape" bpmnElement="age_not_found_end_event">
        <dc:Bounds x="432" y="220" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="412" y="263" width="76" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      
      <!-- Sequence Flows -->
      <bpmndi:BPMNEdge id="age_flow_start_edge" bpmnElement="age_flow_start_to_routing">
        <di:waypoint x="216" y="138" />
        <di:waypoint x="270" y="138" />
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge id="age_flow_routing_edge" bpmnElement="age_flow_routing_to_gateway">
        <di:waypoint x="370" y="138" />
        <di:waypoint x="425" y="138" />
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge id="age_flow_found_edge" bpmnElement="age_flow_person_found">
        <di:waypoint x="475" y="138" />
        <di:waypoint x="525" y="138" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="491" y="120" width="18" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge id="age_flow_not_found_edge" bpmnElement="age_flow_person_not_found">
        <di:waypoint x="450" y="163" />
        <di:waypoint x="450" y="220" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="459" y="189" width="15" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge id="age_flow_minor_edge" bpmnElement="age_flow_is_minor">
        <di:waypoint x="550" y="113" />
        <di:waypoint x="550" y="90" />
        <di:waypoint x="630" y="90" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="570" y="72" width="65" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge id="age_flow_adult_edge" bpmnElement="age_flow_is_adult">
        <di:waypoint x="550" y="163" />
        <di:waypoint x="550" y="220" />
        <di:waypoint x="630" y="220" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="570" y="232" width="70" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge id="age_flow_minor_success_edge" bpmnElement="age_flow_minor_to_success">
        <di:waypoint x="730" y="90" />
        <di:waypoint x="755" y="90" />
        <di:waypoint x="755" y="138" />
        <di:waypoint x="780" y="138" />
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge id="age_flow_adult_success_edge" bpmnElement="age_flow_adult_to_success">
        <di:waypoint x="730" y="220" />
        <di:waypoint x="755" y="220" />
        <di:waypoint x="755" y="138" />
        <di:waypoint x="780" y="138" />
      </bpmndi:BPMNEdge>
      
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
  
</bpmn:definitions>